<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<style type="text/css">
			*{
				padding:0;
				margin:0;
				list-style: none;
			}
			.box{
				margin:100px 100px;
				border:1px solid red;
				float:left;
				width:100px;
				box-sizing: border-box;
			}
			.box li{
				width:100px;
				height:50px;
				background: #ccc;
			}
			.con{
				margin-top:50px;
				margin-left:300px;
				width:400px;
				height:400px;
				border:1px solid red;
			}
			.item{
				width:600px;
				height:400px;
				background: palevioletred;
				position: absolute;
				display: none;
			}
			.active{
				display: block;
			}
			.ddd{
				width:400px;
				height:300px;
				background: peru;
				position: absolute;		
				bottom:50px;
				left:50px;	
				z-index: 999;
				display: none;
				padding: 30px 0 0 50px;
			}
			.sub{
				width:100px;
				height:50px;
				z-index: 999999;
				position: absolute;
				bottom:50px;
				left:70%;
				background: red;
			}
			.scoreAll li{
				width:100px;
				height:30px;
				float:left;
			}
		</style>
	</head>
	<body>		
		<!--弹出层-->
		<div class="ddd">
			<div class="">
				序号<input type="text" name="xuhao" id="xuhao" value="" />
			</div>
			
			<div class="">
				姓名<input type="text" name="user" id="user" value="" />
			</div>
			<div class="">
				业务<input type="text" name="yewu" id="yeWuScore" value="" />
			</div>
			<div class="">
				管理<input type="text" name="guanli" id="guanLiScore" value="" />
			</div>
			<div class="">
				技术<input type="text" name="guanli" id="jiShuScore" value="" />
			</div>
			<div class="">
				专业<input type="text" name="guanli" id="zhuanYeScore" value="" />
			</div>
			<div class="">
				<button class="save">保存</button>
			</div>
		</div>
		<!--打分容器-->
		<div class="con">
			<div class="">
				<h1>排行榜</h1>
				<ul class="scoreAll">
					
				</ul>
				<button class="pai">点我</button>
			</div>
			
			<div class="item active">
				<h1>业务打分</h1>
				<table border="1" cellspacing="0" cellpadding="0">  
			        <thead class="thead">  
			            <tr>  
			                <th>序号</th>  
			                <th>姓名</th>  
			                <th>业务能力分数</th>  
			                <th>管理能力分数</th> 
			                <th>技术能力分数</th> 
			                <th>专业能力分数</th> 
			                <th>操作</th>
			            </tr>  
			        </thead>  
			        <tbody class="tbody"></tbody>       
			    </table>
			    <button class="sub">提交</button>
			</div>

		
		</div>
		
	</body>
	<script src="js/jquery.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript">
	//获取名单
	function scoreYewu() {
		var _index=0
		$.ajax({
			type:'post',        										
			url:'/user',	
			async:true,			
			dataType:"json",
			success:function(data){		
				var trHtml=''						
				var data=data
				$.each(data,function(index,ele){
					_index++;							
					trHtml += "<tr>"
						  +"<td>"+_index+"</td>"								 
						  +"<td class='names'>"+ele.name+"</td>"
						  +"<td class='yewu'>14</td>"
						  +"<td class='guanLi'>20</td>"
						  +"<td class='jiShu'>20</td>"
						  +"<td class='zhuanYe'>20</td>"
						  +"<td bgcolor='#FF0000'><button class='btn'>修改</button></td>"								  
						 +'</tr>';
				})
				$(".tbody").append(trHtml)
				layerSaveScore()//打分
			}
		})
	}
	scoreYewu()
	
	
	//点击打分
	function layerSaveScore(){
		$(".btn").click(function(){
			$(".ddd").show()			
			var aa=$(this).parent().parent()			
			var score1=aa.children('td').eq(0).html()
			var score6=aa.children('td').eq(1).html()
			var score2=aa.children('td').eq(2).html()
			var score3=aa.children('td').eq(3).html()
			var score4=aa.children('td').eq(4).html()
			var score5=aa.children('td').eq(5).html()		
			$("#xuhao").val(score1)
			$("#user").val(score6)
			$("#yeWuScore").val(score2)
			$("#guanLiScore").val(score3)
			$("#jiShuScore").val(score4)
			$("#zhuanYeScore").val(score5)	
		})	
		$(".save").click(function(){					
			var score3=$("#yeWuScore").val()
			var score4=$("#guanLiScore").val()
			var score5=$("#jiShuScore").val()
			var score6=$("#zhuanYeScore").val()						
			var _num = $("#xuhao").val();			
			console.log(_num)
			var allTr=$(".tbody tr")		
			var nd_tr=allTr[_num-1]
			var nd_allTd = nd_tr.querySelectorAll('td');
			nd_allTd[2].innerText=score3
			nd_allTd[3].innerText=score4
			nd_allTd[4].innerText=score5
			nd_allTd[5].innerText=score6			
			$(".ddd").hide()				
		})
	}

	
		
		
	
		
		$(function(){
			$(".sub").click(function(){
				var yw=$(".yewu").text()
				var gl=$(".guanLi").text()
				var js=$(".jiShu").text()				
				var zy=$(".zhuanYe").text()	
				var namess=$(".names").text()
				$.ajax({
					type:'post',        										
					url:'/score',	
					async:true,			
					dataType:"json",
					data:{
						"yewu":yw,
						"guanLi":gl,
						"jiShu":js,
						"zhuanYe":zy
						
					},					
					success:function(data){								
						var data=data
						console.log(data)		
					}
				})
			})					
		})
		$(function(){
			$(".pai").click(function(){
				var arr1=[]
				$.ajax({
					type:'post',        										
					url:'/getScore',	
					async:true,			
					dataType:"json",									
					success:function(data){								
						var data=data
						console.log(data)

						var str0=data[0].guanLi
						var arr=[]
					//	console.log(str1.length)
						for (var j=1;j<str0.length+1;j++) {							
					//		console.log(str0.charAt(j))
							if (j%2==0){									
								arr.push(str0.charAt(j-2)+str0.charAt(j-1))								
							}
							
						}
						
						var str1=data[0].yewu
						
						var arr1=[]
					//	console.log(str1.length)
						for (var j=1;j<str1.length+1;j++) {							
					//		console.log(str1.charAt(j))
							if (j%2==0){									
								arr1.push(str1.charAt(j-2)+str1.charAt(j-1))								
							}
							
						}
						
						var str2=data[0].jiShu
					
						var arr2=[]
					//	console.log(str2.length)
						for (var j=1;j<str2.length+1;j++) {							
					//		console.log(str2.charAt(j))
							if (j%2==0){									
								arr2.push(str2.charAt(j-2)+str2.charAt(j-1))								
							}
							
						}
						var str3=data[0].zhuanYe
						var arr3=[]
						console.log(str3.length)
						for (var j=1;j<str3.length+1;j++) {							
					//		console.log(str3.charAt(j))
							if (j%2==0){									
								arr3.push(str3.charAt(j-2)+str3.charAt(j-1))								
							}
							
						}
		
						var arr7=[]		
						for  (var k=0;k<arr.length;k++){
							arr7.push(parseInt(arr[k])+parseInt(arr1[k])+parseInt(arr2[k])+parseInt(arr3[k]))						
						}
						console.log(arr7)
						var liHtml=''
						for (var z=0;z<arr7.length;z++){
							liHtml+="<li>"+arr7[z]+"</li>"
						}
						
						
						$(".scoreAll").append(liHtml)
					}
				})
			})
		})
	</script>
</html>
